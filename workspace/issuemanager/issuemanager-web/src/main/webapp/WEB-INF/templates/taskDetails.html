<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" xmlns:dt="http://github.com/dandelion/datatables" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout">

<head>
    <title>Task Details</title>

</head>

<body>
    <section class="content" layout:fragment="content">

        <form action="#" class="form-horizontal" th:object="${task}" method="post" id="taskForm">

            <blockquote>
                <p>
                    <i class="fa fa-tasks" aria-hidden="true"></i>
                    <i class="text" th:text="*{group.name}"></i>
                    <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
                    <a class="text" th:text="*{id}" th:href="@{'/editTask/' + ${id}}"></a>
                    <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
                    <i class="text" th:text="*{subject}"></i>
                </p>
            </blockquote>

            <div id="navigationTabs" class="tabs" ng-multi-transclude="tabs">
                <div class="ui menu attached headerWrapperTabs myWorkTabs ng-scope" name="tabs">
                    <div class="btn-group">
                        <div class="row">
                            <div class="col-md-1">
                                <div class="row" th:attr="hidden=${(#lists.contains(userInfo.roleNames,'admin') || #lists.contains(userInfo.roleNames,'manager')) ? 'false' : 'true'}">
                                    <a class="btn btn-info btn-md" th:href="@{'/addRelation/'+ ${id}}">
                                        <i class="text">افزودن رابطه</i>
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-1" th:attr="hidden=${(#lists.contains(userInfo.roleNames,'admin') || #lists.contains(userInfo.roleNames,'manager')) ? 'false' : 'true'}">
                                &nbsp;
                            </div>
                            <div class="col-md-1">
                                <div class="row">
                                    <a class="btn btn-info btn-md" th:href="@{'/addAttachment/'+ ${id}}">
                                        <i class="text">افزودن پیوست</i>
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-1">
                                &nbsp;
                            </div>
                            <div class="col-md-1">
                                <div class="row" th:attr="hidden=${(#lists.contains(userInfo.roleNames,'admin') || #lists.contains(userInfo.roleNames,'manager')) ? 'false' : 'true'}">
                                    <a class="btn btn-info btn-md" th:href="@{'/changeStatus/'+ ${id}}">
                                        <i class="text" th:text="#{title_change_status}"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-1" th:attr="hidden=${(#lists.contains(userInfo.roleNames,'admin') || #lists.contains(userInfo.roleNames,'manager')) ? 'false' : 'true'}">
                                &nbsp;
                            </div>
                            <div class="col-md-1">
                                <div class="row" th:attr="hidden=${(#lists.contains(userInfo.roleNames,'admin') || #lists.contains(userInfo.roleNames,'manager')) ? 'false' : 'true'}">
                                    <a class="btn btn-info btn-md" th:href="@{'/assignTo/'+ ${id}}">
                                        <i class="text" th:text="#{title_change_assignto}"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-1" th:attr="hidden=${(#lists.contains(userInfo.roleNames,'admin') || #lists.contains(userInfo.roleNames,'manager')) ? 'false' : 'true'}">
                                &nbsp;
                            </div>
                            <div class="col-md-1">
                                <div class="row">
                                    <a class="btn btn-info btn-md" th:href="@{'/comment/'+ ${id}}">
                                        <i class="text" th:text="#{title_comments}"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="right menu">
                    </div>
                </div>
            </div>



            <div class="row">
                <div class="col-md-9">

                    <div class="row">
                        <input name="taskId" th:value="${id}" type="hidden" />
                        <input type="hidden" class="input-small" th:value="${id}" th:field="*{id}" placeholder="Subject" readonly="true" />
                        <ul class="list-group" th:if="*{description != ''}">
                            <li class="list-group-item" id="description" text:lineseparator="*{description}" name="description" placeholder="شرح" />
                            <li class="list-group-item" th:if="${attachmentsHistory!=null}">
                                <div th:each="attach : ${attachmentsHistory}">
                                    <code th:text="'#'+${attach.id}"></code>
                                    <a target="_blank" th:if="${attach.name != null}" th:text="${attach.name}" th:href="@{'/downloadAttachment/'+${attach.id}}"></a>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="row">
                        <div id="content">
                            <ul class="nav nav-tabs" th:if="${(#lists.contains(userInfo.roleNames,'admin') || #lists.contains(userInfo.roleNames,'manager'))}">

                                <li class="active">
                                    <a href="#all" data-toggle="tab" hidden="true"> مجموع فعالیت‌ها <span class="badge" th:text="${aggregatedSize}" ></span></a>
                                </li>

                                <li>
                                    <a href="#commentTask" data-toggle="tab"><span class="fa fa-comments-o" aria-hidden="true"></span> یادداشت‌ها <span class="badge" th:text="${commentSize}"></span></a>
                                </li>

                                <li>
                                    <a href="#commentsChangeAssignTo" data-toggle="tab"><span class="fa fa-history" aria-hidden="true"></span>  تاریخچه تغییر انتساب <span class="badge" th:text="${taskAssignmentSize}"></span></a>
                                </li>


                                <li>
                                    <a href="#commentsChangeStatus" data-toggle="tab"><span class="fa fa-history" aria-hidden="true"> </span>  تاریخچه تغییر وضعیت <span class="badge" th:text="${statusHistorySize}"></span> </a>

                                </li>

                                <li>
                                    <a href="#attachmentsHistory" data-toggle="tab"><span class="fa fa-history" aria-hidden="true"> </span>  تاریخچه پیوست‌ <span class="badge" th:text="${taskAttachmentSize}"></span> </a>
                                </li>

                                <li>

                                    <a href="#relationHistory" data-toggle="tab"><span class="fa fa-history" aria-hidden="true"> </span>  تاریخچه رابطه <span class="badge" th:text="${relationSize}"></span> </a>

                                </li>
                            </ul>

                            <ul class="nav nav-tabs" th:if="${!(#lists.contains(userInfo.roleNames,'admin') || #lists.contains(userInfo.roleNames,'manager'))}">


                                <li>
                                    <a href="#commentTask" data-toggle="tab"><span class="fa fa-comments-o" aria-hidden="true"></span> یادداشت‌ها <span class="badge" th:text="${commentSize}"></span></a>
                                </li>


                                <li>
                                    <a href="#attachmentsHistory" data-toggle="tab"><span class="fa fa-history" aria-hidden="true"> </span>  تاریخچه پیوست‌ <span class="badge" th:text="${taskAttachmentSize}"></span> </a>
                                </li>

                            </ul>

                            <div id="my-tab-content" class="tab-content">

                                <div class="tab-pane active" id="all">
                                    <ul class="list-group">
                                        <div th:each="row : ${aggregatedHistoryVOs}">
                                            <div th:if="${row.type == T(com.parvanpajooh.issuemanager.model.enums.TableNameEnum).TaskAssignmentHistory}" class="tab-pane active" id="all">
                                                <li class="list-group-item" style="background-color: #ffffe6">

                                                    <div class="row">
                                                        <div class="col-md-1">
                                                            <img class="img-rounded" th:src="@{'/image/'+${row.createUserId}}" width="40" height="40" />
                                                        </div>

                                                        <div class="col-md-11">
                                                            <div class="row">
                                                                <div class="col-md-11">
                                                                    <strong target="_blank" class="text-primary" th:text="${row.createUser}"></strong>
                                                                    <small>&nbsp;&nbsp;تغییر انتساب داد&nbsp;&nbsp;</small>
                                                                    <small style="color:red;" th:if="${row.jsonsMap.get('version') != 0}">&nbsp;&nbsp;edited &nbsp;&nbsp;</small>
                                                                    <abbr class="timeago" th:title="${row.updateDate}" dir="ltr" /><br/>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <div class="pull left">
                                                                        <div class="btn-group">
                                                                            <a class="btn btn-default btn-sm" th:href="@{'/editTaskAssignment/'+${row.jsonsMap.get('id')}}" type="submit"> <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>

                                                            <div class="row" bgcolor="#eee">
                                                                <div class="col-md-1">
                                                                    <div class="pull-left">
                                                                        از:
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <div class="row">
                                                                        <div class="col-md-2">
                                                                            <img class="img-rounded" th:if="${row.jsonsMap.get('memberFromId') != null}" th:src="@{'/image/'+${row.jsonsMap.get('memberFromId')}}" width="20" height="20" />
                                                                        </div>
                                                                        <div class="col-md-10">
                                                                            <del th:if="${row.jsonsMap.get('memberFrom') != null}" th:text="${row.jsonsMap.get('memberFrom')}"></del>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">&nbsp;</div>
                                                                <div class="col-md-1">
                                                                    <div class="pull-left">
                                                                        به:
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <div class="row">
                                                                        <div class="col-md-2">
                                                                            <img class="img-rounded" th:if="${row.jsonsMap.get('memberToId') != null}" th:src="@{'/image/'+${row.jsonsMap.get('memberToId')}}" width="20" height="20" />
                                                                        </div>
                                                                        <div class="col-md-10">
                                                                            <strong th:if="${row.jsonsMap.get('memberTo') != null }" th:text="${row.jsonsMap.get('memberTo')}"></strong>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>


                                                            <div class="row">
                                                                <div class="col-md-12" th:if="${row.jsonsMap.get('comment') != null}">
                                                                    <i data-toggle="dropdown" text:lineseparator="${row.jsonsMap.get('comment')}" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                            </div>


                                            <div th:if="${row.type == T(com.parvanpajooh.issuemanager.model.enums.TableNameEnum).Comment}">
                                                <li class="list-group-item" style="background-color: #eeffee">
                                                    <div class="row">
                                                        <div class="col-md-1">
                                                            <img class="img-rounded" th:src="@{'/image/'+${row.createUserId}}" width="40" height="40" />
                                                        </div>
                                                        <div class="col-md-11">
                                                            <div class="row">
                                                                <div class="col-md-10">
                                                                    <strong class="text-primary" th:text="${row.createUser}"></strong>
                                                                    <small>&nbsp;&nbsp;یادداشت گذاشت&nbsp;&nbsp;</small>
                                                                    <small style="color: red;" th:if="${row.jsonsMap.get('version') != 0}">&nbsp;&nbsp;edited
																													&nbsp;&nbsp;</small>
                                                                    <abbr class="timeago" th:title="${row.updateDate}" dir="ltr" /><br/>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="pull left">
                                                                        <div class="btn-group">
                                                                            <a class="btn btn-default btn-sm" th:href="@{'/editComment/'+${row.jsonsMap.get('id')}}" type="submit"> <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                                                            </a>
                                                                            <a class="btn btn-default btn-sm" th:href="@{'/removeComment/'+${row.jsonsMap.get('id')}}" type="submit" onclick="return confirm('Are you sure you want to delete this items?')">
                                                                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <code th:text="'#'+${row.jsonsMap.get('id')}"></code><br/>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <i th:if="${row.jsonsMap.get('description') != null}" text:lineseparator="${row.jsonsMap.get('description')}" />
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </li>
                                            </div>


                                            <div th:if="${row.type == T(com.parvanpajooh.issuemanager.model.enums.TableNameEnum).TaskStatusHistory}">
                                                <li class="list-group-item" style="background-color: #f3eeff">
                                                    <div class="row">
                                                        <div class="col-md-1">
                                                            <img class="img-rounded" th:src="@{'/image/'+${row.createUserId}}" width="40" height="40" />
                                                        </div>

                                                        <div class="col-md-11">
                                                            <div class="row">
                                                                <div class="col-md-11">
                                                                    <strong target="_blank" class="text-primary" th:text="${row.createUser}"></strong>
                                                                    <small>&nbsp;&nbsp;تغییر وضعیت داد&nbsp;&nbsp;</small>
                                                                    <small style="color:red;" th:if="${row.jsonsMap.get('version') != 0}">&nbsp;&nbsp;edited &nbsp;&nbsp;</small>
                                                                    <abbr class="timeago" th:title="${row.updateDate}" dir="ltr" /><br/>
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <div class="pull left">
                                                                        <div class="btn-group">
                                                                            <a class="btn btn-default btn-sm" th:href="@{'/editTaskStatus/'+${row.jsonsMap.get('id')}}" type="submit"> <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-md-1">
                                                                    <div class="pull-left">
                                                                        از:
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <del class="text-lowercase" th:if="${row.jsonsMap.get('fromStatus') != null}" th:text="${row.jsonsMap.get('fromStatus')}"></del>
                                                                </div>
                                                                <!-- <div class="col-md-2" >&nbsp;</div> -->
                                                                <div class="col-md-1">
                                                                    <div class="pull-left">
                                                                        به:
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <strong class="text-lowercase" th:if="${row.jsonsMap.get('toStatus') != null}" th:text="${row.jsonsMap.get('toStatus')}"></strong>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-md-12" th:if="${row.jsonsMap.get('comment') != null}">
                                                                    <!--     <i  data-toggle="dropdown" text:lineseparator="${row.jsonsMap.get('comment')}" /> -->
                                                                    <i data-toggle="dropdown" text:lineseparator="${row.jsonsMap.get('comment')}" />
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                            </div>

                                            <div th:if="${row.type == T(com.parvanpajooh.issuemanager.model.enums.TableNameEnum).TaskAttachment}">
                                                <li class="list-group-item" style="background-color: #ecfcff">

                                                    <div class="row">
                                                        <div class="col-md-1">
                                                            <img class="img-rounded" th:src="@{'/image/'+${row.createUserId}}" width="40" height="40" />
                                                        </div>

                                                        <div class="col-md-11">
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <strong target="_blank" class="text-primary" th:text="${row.createUser}"></strong>
                                                                    <small>&nbsp;&nbsp;پیوست اضافه کرد&nbsp;&nbsp;</small>
                                                                    <small style="color:red;" th:if="${row.jsonsMap.get('version') != 0}">&nbsp;&nbsp;edited &nbsp;&nbsp;</small>
                                                                    <abbr class="timeago" th:title="${row.updateDate}" dir="ltr" /><br/>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <code th:text="'#'+${row.jsonsMap.get('id')}"></code><br/>
                                                                    <a target="_blank" th:if="${row.jsonsMap.get('name') != null}" th:text="${row.jsonsMap.get('name')}" th:href="@{'/downloadAttachment/'+${row.jsonsMap.get('id')}}" />
                                                                </div>
                                                                <div class="col-md-5">
                                                                    &nbsp;
                                                                </div>
                                                                <div class="col-md-1">
                                                                    <a class="btn btn-default btn-sm" th:href="@{'/removeAttachment/'+${row.jsonsMap.get('id')}}" type="submit" onclick="return confirm('Are you sure you want to delete this items?')">
                                                                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                                                    </a>
                                                                </div>
                                                            </div>


                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <i th:if="${row.jsonsMap.get('comment') != null}" text:lineseparator="${row.jsonsMap.get('comment')}" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                            </div>

                                            <div th:if="${row.type == T(com.parvanpajooh.issuemanager.model.enums.TableNameEnum).Relation}">
                                                <li class="list-group-item" style="background-color: #fff3e6">

                                                    <div class="row">
                                                        <div class="col-md-1">
                                                            <img class="img-rounded" th:src="@{'/image/'+${row.createUserId}}" width="40" height="40" />
                                                        </div>

                                                        <div class="col-md-11">
                                                            <div class="row">
                                                                <div class="col-md-10">
                                                                    <strong target="_blank" class="text-primary" th:text="${row.createUser}"></strong>
                                                                    <small>&nbsp;&nbsp;رابطه اضافه کرد &nbsp;&nbsp;</small>
                                                                    <small style="color:red;" th:if="${row.jsonsMap.get('version') != 0}">&nbsp;&nbsp;edited &nbsp;&nbsp;</small>
                                                                    <abbr class="timeago" th:title="${row.updateDate}" dir="ltr" /><br/>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="pull left">
                                                                        <div class="btn-group">
                                                                            <a class="btn btn-default btn-sm" th:href="@{'/editRelation/'+${row.jsonsMap.get('id')}}" type="submit">
                                                                                <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                                                            </a>
                                                                            <a class="btn btn-default btn-sm" th:href="@{'/removeRelation/'+${row.jsonsMap.get('id')}}" type="submit" onclick="return confirm('Are you sure you want to delete this items?')">
                                                                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <code th:text="'#'+${row.jsonsMap.get('id')}"></code><br/>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-4">
                                                                    <div class="pull-right" th:text="${row.jsonsMap.get('fromTask')}">

                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="pull-right" th:text="${row.jsonsMap.get('type')}" />

                                                                </div>
                                                                <div class="col-md-4">

                                                                    <div class="pull-right" th:text="${row.jsonsMap.get('toTask')}">

                                                                    </div>
                                                                </div>
                                                            </div>


                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <i th:if="${row.jsonsMap.get('description') != null}" text:lineseparator="${row.jsonsMap.get('description')}" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                            </div>

                                        </div>
                                    </ul>
                                </div>

                                <div class="tab-pane" id="commentTask">
                                    <ul class="list-group">
                                        <div th:each="comment : ${comments}">
                                            <li class="list-group-item" style="background-color: #eeffee">
                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <img class="img-rounded" th:src="@{'/image/'+${comment.createUserId}}" width="40" height="40" />
                                                    </div>
                                                    <div class="col-md-11">
                                                        <div class="row">
                                                            <div class="col-md-10">
                                                                <strong class="text-primary" th:text="${comment.createUser}"></strong>
                                                                <small>&nbsp;&nbsp;یادداشت گذاشت&nbsp;&nbsp;</small>
                                                                <small style="color: red;" th:if="${comment.version != 0}">&nbsp;&nbsp;edited
																													&nbsp;&nbsp;</small>
                                                                <abbr class="timeago" th:title="${comment.updateDate}" dir="ltr" /><br />
                                                            </div>
                                                            <div class="col-md-2">
                                                                <div class="pull left">
                                                                    <div class="btn-group">
                                                                        <a class="btn btn-default btn-sm" th:href="@{'/editComment/'+${comment.id}}" type="submit"> <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                                                        </a>
                                                                        <a class="btn btn-default btn-sm" th:href="@{'/removeComment/'+${comment.id}}" type="submit" onclick="return confirm('Are you sure you want to delete this items?')">
                                                                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <code th:text="'#'+${comment.id}"></code><br/>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <i th:if="${comment.description != null}" text:lineseparator="${comment.description}" />
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </li>
                                        </div>
                                    </ul>
                                </div>


                                <div id="exampleModal" class="modal fade text-center">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                        </div>
                                    </div>
                                </div>



                                <div class="tab-pane" id="commentsChangeAssignTo">
                                    <ul class="list-group">
                                        <div th:each="comment : ${commentsChangeAssignTo}">
                                            <li class="list-group-item" style="background-color: #ffffe6">

                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <img class="img-rounded" th:src="@{'/image/'+${comment.createUserId}}" width="40" height="40" />
                                                    </div>

                                                    <div class="col-md-11">
                                                        <div class="row">
                                                            <div class="col-md-11">
                                                                <strong target="_blank" class="text-primary" th:text="${comment.createUser}"></strong>
                                                                <small>&nbsp;&nbsp;تغییر انتساب داد&nbsp;&nbsp;</small>
                                                                <small style="color:red;" th:if="${comment.version != 0}">&nbsp;&nbsp;edited &nbsp;&nbsp;</small>
                                                                <abbr class="timeago" th:title="${comment.updateDate}" dir="ltr" /><br/>
                                                            </div>
                                                            <div class="col-md-1">
                                                                <div class="pull left">
                                                                    <div class="btn-group">
                                                                        <a class="btn btn-default btn-sm" th:href="@{'/editTaskAssignment/'+${comment.id}}" type="submit"> <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row" bgcolor="#eee">
                                                            <div class="col-md-1">
                                                                <div class="pull-left">
                                                                    از:
                                                                </div>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <div class="row">
                                                                    <div class="col-md-2">
                                                                        <img class="img-rounded" th:if="${comment.memberFrom != null}" th:src="@{'/image/'+${comment.memberFrom.id}}" width="20" height="20" />
                                                                    </div>
                                                                    <div class="col-md-10">
                                                                        <del th:if="${comment.memberFrom != null}" th:text="${comment.memberFrom.username}"></del>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-2">&nbsp;</div>
                                                            <div class="col-md-1">
                                                                <div class="pull-left">
                                                                    به:
                                                                </div>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <div class="row">
                                                                    <div class="col-md-2">
                                                                        <img class="img-rounded" th:if="${comment.memberTo != null}" th:src="@{'/image/'+${comment.memberTo.id}}" width="20" height="20" />
                                                                    </div>
                                                                    <div class="col-md-10">
                                                                        <strong th:if="${comment.memberTo != null}" th:text="${comment.memberTo.username}"></strong>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-md-12" th:if="${comment.comment != null}">
                                                                <i data-toggle="dropdown" text:lineseparator="${comment.comment}" />

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </div>
                                    </ul>
                                </div>


                                <div class="tab-pane" id="commentsChangeStatus">
                                    <ul class="list-group">
                                        <div th:each="comment : ${commentsChangeStatus}">

                                            <li class="list-group-item" style="background-color: #f3eeff">

                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <img class="img-rounded" th:src="@{'/image/'+${comment.createUserId}}" width="40" height="40" />
                                                    </div>

                                                    <div class="col-md-11">
                                                        <div class="row">
                                                            <div class="col-md-11">
                                                                <strong target="_blank" class="text-primary" th:text="${comment.createUser}"></strong>
                                                                <small>&nbsp;&nbsp;تغییر وضعیت داد&nbsp;&nbsp;</small>
                                                                <small style="color:red;" th:if="${comment.version != 0}">&nbsp;&nbsp;edited &nbsp;&nbsp;</small>
                                                                <abbr class="timeago" th:title="${comment.updateDate}" dir="ltr" /><br/>
                                                            </div>
                                                            <div class="col-md-1">
                                                                <div class="pull left">
                                                                    <div class="btn-group">
                                                                        <a class="btn btn-default btn-sm" th:href="@{'/editTaskStatus/'+${comment.id}}" type="submit"> <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-md-1">
                                                                <div class="pull-left">
                                                                    از:
                                                                </div>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <del class="text-lowercase" th:if="${comment.fromStatus != null}" text:lineseparator="${comment.fromStatus}"></del>
                                                            </div>
                                                            <!-- <div class="col-md-2" >&nbsp;</div> -->
                                                            <div class="col-md-1">
                                                                <div class="pull-left">
                                                                    به:
                                                                </div>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <strong class="text-lowercase" th:if="${comment.toStatus != null}" th:text="${comment.toStatus}"></strong>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-md-12" th:if="${comment.comment != null}">
                                                                <i data-toggle="dropdown" text:lineseparator="${comment.comment}" />

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </div>
                                    </ul>
                                </div>


                                <div class="tab-pane" id="attachmentsHistory">
                                    <ul class="list-group">
                                        <div th:each="attach : ${attachmentsHistory}">
                                            <li class="list-group-item" style="background-color: #ecfcff">

                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <img class="img-rounded" th:src="@{'/image/'+${attach.createUserId}}" width="40" height="40" />
                                                    </div>

                                                    <div class="col-md-11">
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <strong target="_blank" class="text-primary" th:text="${attach.createUser}"></strong>
                                                                <small>&nbsp;&nbsp;پیوست اضافه کرد&nbsp;&nbsp;</small>
                                                                <small style="color:red;" th:if="${attach.version != 0}">&nbsp;&nbsp;edited &nbsp;&nbsp;</small>
                                                                <abbr class="timeago" th:title="${attach.updateDate}" dir="ltr" /><br/>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <code th:text="'#'+${attach.id}"></code><br/>
                                                                <a target="_blank" th:if="${attach.name != null}" th:text="${attach.name}" th:href="@{'/downloadAttachment/'+${attach.id}}" />
                                                            </div>
                                                            <div class="col-md-5">
                                                                &nbsp;
                                                            </div>
                                                            <div class="col-md-1">
                                                                <a class="btn btn-default btn-sm" th:href="@{'/removeAttachment/'+${attach.id}}" type="submit" onclick="return confirm('Are you sure you want to delete this items?')">
                                                                    <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                                                </a>
                                                            </div>
                                                        </div>


                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <i th:if="${attach.comment != null}" text:lineseparator="${attach.comment}" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </div>
                                    </ul>
                                </div>

                                <div class="tab-pane" id="relationHistory">
                                    <ul class="list-group">
                                        <div th:each="r : ${relationsHistory}">
                                            <li class="list-group-item" style="background-color: #fff3e6">

                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <img class="img-rounded" th:src="@{'/image/'+${r.createUserId}}" width="40" height="40" />
                                                    </div>

                                                    <div class="col-md-11">
                                                        <div class="row">
                                                            <div class="col-md-10">
                                                                <strong target="_blank" class="text-primary" th:text="${r.createUser}"></strong>
                                                                <small>&nbsp;&nbsp;رابطه اضافه کرد &nbsp;&nbsp;</small>
                                                                <small style="color:red;" th:if="${r.version != 0}">&nbsp;&nbsp;edited &nbsp;&nbsp;</small>
                                                                <abbr class="timeago" th:title="${r.updateDate}" dir="ltr" /><br/>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <div class="pull left">
                                                                    <div class="btn-group">
                                                                        <a class="btn btn-default btn-sm" th:href="@{'/editRelation/'+${r.id}}" type="submit">
                                                                            <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                                                        </a>
                                                                        <a class="btn btn-default btn-sm" th:href="@{'/removeRelation/'+${r.id}}" type="submit" onclick="return confirm('Are you sure you want to delete this items?')">
                                                                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-md-11">
                                                                <code th:text="'#'+${r.id}"></code><br/>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-4">
                                                                <div class="pull-right" th:text="${r.fromTask.subject}">

                                                                </div>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <div class="pull-right" th:text="${r.type.value}" />

                                                            </div>
                                                            <div class="col-md-4">

                                                                <div class="pull-right" th:text="${r.toTask.subject}">

                                                                </div>
                                                            </div>
                                                        </div>


                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <i th:if="${r.description != null}" text:lineseparator="${r.description}" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </div>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



                <div class="col-md-3">

                    <div class="panel panel-default">

                        <div class="panel-heading">
                            <div class="text-center" th:text="*{currentTaskStatus}">
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <label th:text="#{lbl_reporter}" class="col-sm-6 control-label"></label>

                                <div class="col-sm-2">
                                    <img class="img-rounded" th:src="@{'/image/'+*{createUserId}}" width="20" height="20" />
                                </div>
                                <div class="col-sm-4">
                                    <input th:value="*{creatMemberUsername}" />
                                </div>
                            </div>
                            <div class="row">
                                <label th:text="#{lbl_updater}" class="col-sm-6 control-label"></label>

                                <div class="col-sm-2">
                                    <img class="img-rounded" th:src="@{'/image/'+*{updateUserId}}" width="20" height="20" />
                                </div>
                                <div class="col-sm-4">
                                    <input th:value="*{updateMemberUsername}" />
                                </div>
                            </div>
                            <div class="row">
                                <label th:text="#{lbl_assignto}" class="col-sm-6 control-label"></label>
                                <div class="col-sm-2" th:if="*{currentMember != null}">
                                    <img class="img-rounded" th:src="@{'/image/'+*{currentMember.id}}" width="20" height="20" />
                                </div>
                                <div class="col-sm-4">
                                    <input th:attr="value=*{currentMember == null ? ' ' : currentMember.firstName +' '+ currentMember.lastName}" />
                                </div>
                            </div>

                            <div class="row">
                                <label th:text="#{lbl_status}" class="col-sm-6 control-label"></label>
                                <div class="col-sm-6">
                                    <input th:attr="value=*{currentTaskStatus.value}" />
                                </div>
                            </div>

                            <div class="row">
                                <label th:text="#{lbl_creatdate}" class="col-sm-6 control-label"></label>
                                <div class="col-sm-6">
                                    <input th:value="*{createDate}" />
                                </div>
                            </div>

                            <div class="row">
                                <label th:text="#{lbl_updatedate}" class="col-sm-6 control-label"></label>
                                <div class="col-sm-6">
                                    <input th:value="*{updateDate}" />
                                </div>
                            </div>

                            <div class="row">
                                <label th:text="#{lbl_dodate}" class="col-sm-6 control-label"></label>
                                <div class="col-sm-6">
                                    <input th:value="*{dueDate}" />
                                </div>
                            </div>
                            <div class="row">
                                <label class="col-sm-6 control-label">اولویت:</label>
                                <div class="col-sm-6">
                                    <input th:attr="value=*{priority == null ? ' ' : priority.value}" />
                                </div>
                            </div>
                            <div class="row">
                                <label class="col-sm-4 control-label">رای‌ها:</label>

                                <div class="col-sm-1">
                                    <div class="dropdown">
                                        <a class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true" href="#">
                                            <span class="badge" th:text="${voteSize}"></span>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li th:each="voter : ${voters}">
                                                <a th:text="${voter.member.firstName}+' '+${voter.member.lastName}"></a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="btn-group">

                                        <a class="btn btn-danger btn-sm" th:href="@{'/task/'+${id}+'/vote'}" type="submit" th:attr="disabled=${voteVO == null ? 'true' : 'false'}">حذف
                                       <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                                  </a>

                                        <a class="btn btn-success btn-sm" th:href="@{'/task/'+${id}+'/vote'}" type="submit" title="حذف" th:attr="disabled=${voteVO == null ? 'false' : 'true'}">افزودن
                                       <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                  </a>

                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                &nbsp;
                            </div>

                            <div class="row">
                                <label class="col-sm-4 control-label">مشاهده کننده ها:</label>

                                <div class="col-sm-1">
                                    <div class="dropdown">
                                        <a class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true" href="#">
                                            <span class="badge" th:text="${watchSize}"></span>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li th:each="watcher : ${watchers}">
                                                <a th:text="${watcher.member.firstName}+' '+${watcher.member.lastName}"></a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="btn-group">

                                        <a class="btn btn-danger btn-sm" th:href="@{'/task/'+${id}+'/watch'}" type="submit" th:attr="disabled=${watchVO == null ? 'true' : 'false'}">حذف
                                       <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                                  </a>

                                        <a class="btn btn-success btn-sm" th:href="@{'/task/'+${id}+'/watch'}" type="submit" th:attr="disabled=${watchVO == null ? 'false' : 'true'}">افزودن
                                       <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                  </a>

                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </form>

        <script>
            //<![CDATA[

            $(document).ready(function() {
                $('[data-toggle="tooltip"]').tooltip();
                $('.dropdown-toggle').dropdownHover();
            });

            function resetLabel(id) {

                var val1 = "رای دادن";
                var val2 = "حذف رای";

                $.post('/issuemanager-web/task/' + id + '/vote').done(function(data) {

                        var str = document.getElementById("vote").innerHTML;
                        if (!str.localeCompare(val1)) {

                            document.getElementById("vote").innerHTML = val2;
                        } else {

                            document.getElementById("vote").innerHTML = val1;
                        }
                    })
                    .fail();
            }


            function memberSelected() {
                var e = document.getElementById("memberId").value;
                var e2 = document.getElementById("statusId").value;
                $('#memberId').val(e);
                $('#statusId').val(e2);
            }
            var hidden = false;

            function showComment() {
                hidden = !hidden;
                if (hidden) {
                    document.getElementById('commentInputId').style.visibility = 'hidden';
                    document.getElementById('saveCommentBtnId').style.visibility = 'hidden';
                } else {
                    document.getElementById('commentInputId').style.visibility = 'visible';
                    document.getElementById('saveCommentBtnId').style.visibility = 'visible';
                }
            }

            function statusSelected() {
                var e = document.getElementById("statusId").value;
                $('#statusId').val(e);
            }

            function saveComment() {

                $('#saveCommentFormId').submit();
            }


            (function timeAgo(selector) {

                var templates = {
                    prefix: "",
                    suffix: " ago",
                    seconds: "less than a minute",
                    minute: "about a minute",
                    minutes: "%d minutes",
                    hour: "about an hour",
                    hours: "about %d hours",
                    day: "a day",
                    days: "%d days",
                    month: "about a month",
                    months: "%d months",
                    year: "about a year",
                    years: "%d years"
                };
                var template = function(t, n) {
                    return templates[t] && templates[t].replace(/%d/i, Math.abs(Math.round(n)));
                };

                var timer = function(time) {
                    if (!time)
                        return;
                    time = time.replace(/\.\d+/, ""); // remove milliseconds
                    time = time.replace(/-/, "/").replace(/-/, "/");
                    time = time.replace(/T/, " ").replace(/Z/, " UTC");
                    time = time.replace(/([\+\-]\d\d)\:?(\d\d)/, " $1$2"); // -04:00 -> -0400
                    time = new Date(time * 1000 || time);

                    var now = new Date();
                    var seconds = ((now.getTime() - time) * .001) >> 0;
                    var minutes = seconds / 60;
                    var hours = minutes / 60;
                    var days = hours / 24;
                    var years = days / 365;

                    return templates.prefix + (
                        seconds < 45 && template('seconds', seconds) ||
                        seconds < 90 && template('minute', 1) ||
                        minutes < 45 && template('minutes', minutes) ||
                        minutes < 90 && template('hour', 1) ||
                        hours < 24 && template('hours', hours) ||
                        hours < 42 && template('day', 1) ||
                        days < 30 && template('days', days) ||
                        days < 45 && template('month', 1) ||
                        days < 365 && template('months', days / 30) ||
                        years < 1.5 && template('year', 1) ||
                        template('years', years)
                    ) + templates.suffix;
                };

                var elements = document.getElementsByClassName('timeago');
                for (var i in elements) {
                    var $this = elements[i];
                    if (typeof $this === 'object') {
                        $this.innerHTML = timer($this.getAttribute('title') || $this.getAttribute('datetime'));
                    }
                }
                // update time every minute
                setTimeout(timeAgo, 60000);

            })();
            //]]>
        </script>
    </section>
</body>

</html>